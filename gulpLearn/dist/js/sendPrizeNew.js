window._gaq=window._gaq||[],$.ajaxSetup({cache:!1}),$.sendPrizeNew=function(e,t){new $.sendPrizeNew.prototype.init(e,t)},$.sendPrizeNew.prototype={constructor:$.sendPrizeNew,startTime:new Date-0,init:function(e,t){$.prizeBox||($.prizeBox=this,this.setting=$.extend({type:"_default",prizeKind:"get_prize_all",defaultCityId:parseInt($.cookie("region_id")),city_bg:"http://image.meilele.com/images/201406/140314561580.png",bgs:{prize_title:"http://image.meilele.com/images/zhuanti//a_title_1469065367.jpg",b_color:"#addf00",color:"#ff4f01"},button:{width:159,height:61,bg:["http://image.meilele.com/images/zhuanti/m_download/btn1_1469584505.png","http://image.meilele.com/images/zhuanti/btn2_1469444448.png","http://image.meilele.com/images/zhuanti/btn3_1469445395.png"]},prize_time:"指定时间是我吧是我吧",onPrizeStart:function(){},onSuccess:function(){}},t),this.exprId=e,this.setStyleRule(),this.phone_time_limit=window._mobile_captcha_times_limit||120,this.setting.exprInfo&&this.setting.exprInfo.exprList&&delete this.setting.exprInfo.exprList,"success"==this.setting.prizeType&&this.setting.prizeInfo?(this.showBox(2),this.sendSuccess()):"error"==this.setting.prizeType?this.showBox("sorry"):this.initData(),$.prizeBox.getCheckImg())},initData:function(e,t){var i=this,s=this.setting.type+"_success_notice",o="/mll_api/api/send_message&type="+this.setting.prizeKind+(this.setting.unique?"&activity="+this.setting.unique:"")+"&ad_code="+s+(t?t:"");$.ajax({url:o,dataType:"json",success:function(s){t?i.prize_num=s.prize_num:(i.prize_num=s.prize_num,i.analysisExprList(s),i.showBox(1)),e&&e.call(i,s)},error:function(){i.removeBox(),$.alert("发生网络错误，请稍候再试！")}})},showBox:function(e){var t="",i="",s=this.setting.prize_time,o="",n=!1;switch(e){case 1:o=this.setting.title.substr(0,15),i+='<p style="line-height:18px;color: #898989;font-size: 13px;padding:22px 22px 15px 22px;">',i+='<span style="font-weight: bold">温馨提示:</span>请于'+s+"期间参与；红包序列号以短信形式发送手机,请注意查收;实物奖品在活动结束后统一发放,请耐心等待",i+="</p>",i+="<form>",i+='<div class="item" style="margin-bottom:0;">',i+='<div id="city_select"></div>',i+='<div id="expr_select"></div>',i+="</div>",i+='<div class="item"><label for="phone_input">手机号：</label><input class="sms_input _sms_shadow" placeholder="请输入您的手机号码" onfocus="$.prizeBox.errorShow(\'\')"  onblur="" id="phone_input" name="phone_input" /><span class="check_icon" id="phone_icon"></span></div>',i+='<div id="phone_msg" style="display: none;"></div>',i+='<div class="item"><label for="check_img">验证码：</label><input class="sms_captcha _sms_shadow" id="check_img" name="check_img" onfocus="$.prizeBox.errorShow(\'\')" ><img src="/solr_api/captcha/getCaptcha.do?&_=0.23046009114496724" title="换一张" onclick="$.prizeBox.getCheckImg()" id="cha_img" />',i+='<span class="check_icon"></span>',i+="</div>",i+='<div class="item"><label for="check_phone">手机验证码：</label><input class="sms_captcha _sms_shadow" id="check_phone" name="check_phone" onfocus="$.prizeBox.errorShow(\'\')" >',i+='<button class="msg_acq" onclick="$.prizeBox.getCheckNum()" type="button">免费获取</button>',i+='<span class="check_icon" id="msg_send"></span>',i+="</div>",i+='<div class="button"><a href="javascript:;" class="submit" onclick="$.prizeBox.getPrize();"></a></div>',i+="</form>",i+='<div class="prize_num_box" style="display: none;">已有<span id="prize_num"></span>人成功摇奖</div>',i+='<div id="error_info"></div>',i+="</div>",n=!1;break;case 2:o="中奖啦!",i+='<p class="yes_title1">'+this.setting.prizeInfo.msg+"!</p>",i+='<p style="padding:0 40px;line-height:18px;color: #898989;font-size: 14px;margin-bottom: 15px">红包序列号以短信形式发送手机,请注意查收;实物奖品在活动结束后统一发放,请耐心等待</p>',i+='<div class="button"><a href="javascript:;" class="success" onclick="$.prizeBox.removeBox(true);"></a></div>',n=!0;break;default:o="遗憾!",i+='<p class="yes_title1">您未获得奖项,请下次抽取 !</p>',i+='<div class="button"><a href="javascript:;" class="error" onclick="$.prizeBox.removeBox(true);"></a></div>',n=!0}t+='<div class="alert_box">',t+='<div style="position: relative">',t+='<h2 class="alert_title">'+o+"</h2>",t+='<div style="position:absolute;z-index:11;top: 10px;right: 5px;" ><a class="sms_close_btn" href="javascript:;" onclick="$.prizeBox.removeBox('+n+');">&times;</a></div>',t+="</div>",t+='<div class="alert_content sms_content">',t+="</div>",t+="</div>",$(".lightBox.sms_lightbox").remove(),$.lightBox(t,{},!0,!1,!1,!1,"sms_lightbox"),$(".alert_content.sms_content").html("").html(i),this.showMask(),1==e&&(this.selectedProvinceId||this.selectedCityId?this.insertExprSelect():this.insertCitySelect(),this.initData("","&contentType=1"),this.getPrizeNum())},showMask:function(){$("#mask").remove(),$("body").prepend('<div id="mask"></div>'),$("#mask").css({height:$(document).height(),width:$(document).width()}).show()},getCheckImg:function(e){$("#check_img").val(""),e?$("#cha_img").attr("src",e):$.getCaptcha($("#cha_img"))},getCheckNum:function(){this.checkValue("msg",function(){var e="/dubbo_api/mll/mobileCaptcha/create_send_check_captcha",t="?phoneNumber="+$.prizeBox.phoneNum+"&exprId="+$.prizeBox.exprId+"&durationTime=120&source_from=0&captchaType="+$.prizeBox.setting.prizeKind+"&captcha="+$.prizeBox.checkVal+"&sendSource=1&sendType=1",i=$("#phone_input").val(),s=$(".msg_acq"),o=$.prizeBox.phone_time_limit;e+=t,$.getJSON(e,function(e){if(0==e.error){$("#phone_msg").show().html("校验码已发送至手机"+i+"请查收"),s.html("("+$.prizeBox.phone_time_limit+"秒后) 重新获取");var t=setInterval(function(){s.html("("+o+"秒后) 重新获取").attr("disabled",!0),o--,o<=0&&(clearInterval(t),o=$.prizeBox.phone_time_limit,s.html("重新获取").removeAttr("disabled"),$.prizeBox.getCheckImg(),$("#phone_msg").hide())},1e3,s)}else{var n=e.msg||"手机校验码发送失败！";$.prizeBox.errorShow(n)}})})},getPrizeNum:function(e){this.prize_num>0&&($(".prize_num_box").show(),$("#prize_num").html(this.prize_num))},getPrize:function(){this.checkValue("prize",function(){$("#phone_msg").hide();var e="/prize_normal.html?act=go&json=1&phone="+$.prizeBox.phoneNum+"&captcha="+$.prizeBox.checkVal+"&expr_id="+$.prizeBox.exprId+"&mobile="+$.prizeBox.phoneNum+"&send_from="+($.cookie("MLLSEO")||"")+"&need_level=1&active_type=11&source_from=0&url="+encodeURIComponent(location.href),t={type:"get_prize_all",autoSend:!1,checkPhone:$.prizeBox.checkPhone,defaultCityId:$.prizeBox.defaultCityId,prize_id:$.prizeBox.setting.prize_id,activityType:22,flag:1};$.getJSON(e,t,function(e){if($.prizeBox.getCheckImg(),"success"==e.code)$.prizeBox.setting.onPrizeStart(!0,{level:e.level,msg:e.msg,pid:e.pid,prize_id:$.prizeBox.setting.prize_id,expr_id:$.prizeBox.exprId,expr_name:$.prizeBox.exprName,phone:$.prizeBox.phoneNum}),$.prizeBox.removeBox();else if("no_prize"===e.code)$.prizeBox.setting.onPrizeStart(!1),$.prizeBox.removeBox();else{var t=e.msg||"抽奖失败！";$.prizeBox.errorShow(t)}})})},sendSuccess:function(){$.ajax({url:"/prize_normal.html?act=finish&pid="+this.setting.prizeInfo.pid+"&prize_id="+this.setting.prizeInfo.prize_id+"&expr_id="+this.setting.prizeInfo.expr_id,csche:!1,success:function(){}})},checkValue:function(e,t){var i=parseInt($("#expr_sel option:selected").val()),s=$("#expr_sel option:selected").html(),o=$("#phone_input").val(),n=$("#check_img").val(),r=$("#check_phone").val();return $.prizeBox.exprId=i,$.prizeBox.exprName=s,$.prizeBox.phoneNum=o,$.prizeBox.checkVal=n,$.prizeBox.checkPhone=r,0==i||isNaN(i)?void $.prizeBox.errorShow("请选择离您最近的体验馆 !"):o&&/^1\d{10}$/.test(o)?""==n||4!==n.length?void $.prizeBox.errorShow("请输入正确的验证号码 !"):"prize"!=e||""!=r&&6===r.length?void(t&&t()):void $.prizeBox.errorShow("手机校验码错误 !"):void $.prizeBox.errorShow("请输入正确的手机号码 !")},errorShow:function(e){$("#error_info").html(e)},removeBox:function(e){e&&($.cookie("_close_",1),$(".alert_button").hasClass("isNeedSuccess")&&$.prizeBox.setting.onSuccess($.prizeBox.setting.prizeInfo)),$(".alert_box,#mask").remove(),delete $.prizeBox},setStyleRule:function(){if(!this.styleInserted){var e=[];e.push(".alert_title{background: url("+this.setting.bgs.prize_title+");background-color:"+this.setting.bgs.b_color+";height: 67px;font-size: 22px;text-align: center;line-height: 67px;font-weight: bold;color: #fff;}"),e.push(".alert_box{position:absolute;left:50%;margin-left:-250px;overflow:hidden;z-index:9;width:421px;top:50%;}"),e.push(".alert_box form{color:#666;}"),e.push(".alert_content{border:5px solid "+this.setting.bgs.b_color+";background-color:#fff;border-top:0;padding-bottom:15px;}"),e.push(".alert_box .button{padding:10px 0;text-align:center;}"),e.push(".alert_box .button a{display:inline-block;width:"+this.setting.button.width+"px;height:"+this.setting.button.height+"px;background-position:center center;background-repeat:no-repeat;}"),e.push(".alert_box .button a.submit{background-image:url("+this.setting.button.bg[0]+")}"),e.push(".alert_box .button a.success{background-image:url("+this.setting.button.bg[1]+")}"),e.push(".alert_box .button a.error{background-image:url("+this.setting.button.bg[2]+")}"),e.push(".yes_title1{padding-top: 17px;padding-bottom: 15px;;word-wrap:break-word;color: "+this.setting.bgs.color+";font-weight: bolder;font-size: 22px;font-family: 微软雅黑;text-align: center;}"),e.push(".msg_acq,#cha_img{height: 30px;margin-left: 8px;cursor: pointer;}"),e.push(".msg_acq{padding:0 5px;height: 30px;margin-left: 8px;cursor: pointer;background:#fafafa;border:1px solid #ddd;line-height:30px;color:#555;text-align:center;display:inline-block;}"),e.push("#phone_msg{color:#999;margin:-10px 0 10px 72px;}"),e.push(".prize_num_box{text-align:center;font-size:14px;}"),e.push("#prize_num{color:"+this.setting.bgs.color+";font-weight:bold;}"),e.push(".item{margin-bottom:15px;}"),e.push("#mask {position: absolute; top: 0px; filter: alpha(opacity=60); background-color: #000;z-index: 299; left: 0px;opacity:0.6; -moz-opacity:0.6;}  "),e.push(".sms_input {width:145px;background: #fafafa;border:1px solid #ddd;border-radius: 2px;padding:7px 0 7px 5px;margin:0;color:#555;}"),e.push("._sms_shadow:focus{transition:border linear .2s,box-shadow linear .2s;-moz-transition:border linear .2s,-moz-box-shadow linear .2s;-webkit-transition:border linear .2s,-webkit-box-shadow linear .2s;outline:none;border-color:#6db9e0;box-shadow:0 0 4px #7fcaf1;-moz-box-shadow:0 0 4px #7fcaf1;-webkit-box-shadow:0 0 4px #7fcaf1;}"),e.push(".sms_captcha {width:68px;background: #fafafa;border-radius: 2px;border:1px solid #ddd;padding:7px 0 7px 5px;margin:0;vertical-align:top;color:#555;}"),e.push(".sms_content label {height:28px; line-height: 28px;width:120px;text-align:right;display:inline-block;vertical-align:top;}"),e.push("._sndsms_select{background: #fafafa;border:0px;margin:0;padding:0px;width:95px;}"),e.push("#error_info{ font-size: 14px;font-family: 微软雅黑;text-align: center;margin-top: 10px;color: "+this.setting.bgs.color+";}"),e.push('.sms_close_btn{font-size:26px;color:#b3b3b3;font-family: "宋体";}'),e.push(".sms_close_btn:hover{text-decoration:none}"),$.insertStyle(e.join("")),this.styleInserted=!0}},selectedExpr:function(e){$.prizeBox.exprId=e,$("#exprSelectBox").css("border-color","#ddd")},insertExprSelect:function(){str="",str+='<div class="clearfix" style="height:43px;"><label class="Left">体验馆：</label><div class="selectbox Left" id="exprSelectBox" style="height:25px;padding-top:5px;border:1px solid #ddd;"><select id="expr_sel" style="border:0px;width:150px;" onchange="$.prizeBox.selectedExpr(this.value);">',str+='<option value="0">请选择体验馆('+this.setting.exprInfo.exprList.length+"家)</option>";for(var e=0;e<this.setting.exprInfo.exprList.length;e++){var t="";1!=this.setting.exprInfo.exprList.length&&this.exprId!=this.setting.exprInfo.exprList[e].exprId||(t=' selected="selected"',this.exprId=this.setting.exprInfo.exprList[e].exprId),str+="<option"+t+' value="'+this.setting.exprInfo.exprList[e].exprId+'" data-need_appointment="'+this.setting.exprInfo.exprList[e].need_appointment+'">'+this.setting.exprInfo.exprList[e].exprName+"</option>"}str+="</select></div>",this.setting.exprInfo&&this.setting.exprInfo.cityName&&!$("#city_select").html()&&(str+='<span id="change_city" class="Left" style="padding-top:9px;"><span style="color:#666;display:inline-block;padding:0 5px 0 15px;background:transparent url('+this.setting.city_bg+') no-repeat scroll 3px -50px;} 3px -50px no-repeat">'+this.setting.exprInfo.cityName+'</span><span><a href="javascript:;" style="color:#ea4800;" onclick="$.prizeBox.insertCitySelect();return false;">更换城市</a></span></span>'),str+="</div>",$("#expr_select").html(str)},insertCitySelect:function(){$("#change_city").hide();var e=this.cityInfo;if(e){var t,i,s="";s+='<div class="clearfix" style="height:43px;">',s+='<label class="Left">所在地：</label>',s+='<div class="selectbox Left" style="height:25px;padding-top:5px;margin-right:5px;border:1px solid #ddd;" id="pro_sel_box"><select class="_sndsms_select" id="province_list" style="background: #fafafa;border:0px;margin:0;padding:0px;" onchange="$.prizeBox.provinceSelected(this.value);">',s+='<option value="0">请选择省</option>';for(i in e){var o="";this.setting.defaultCityId&&e[i]&&e[i].cityList&&e[i].cityList[this.setting.defaultCityId]&&(o=' selected="selected"',t=i),s+='<option value="'+i+'"'+o+">"+e[i].provinceName+"</option>"}s+="</select></div>",s+='<div class="selectbox Left" style="height:25px;padding-top:5px;border:1px solid #ddd;" id="city_sel_box" style="margin-left:12px;"><select class="_sndsms_select" id="city_list" onchange="$.prizeBox.citySelected(this.value,this.options[this.selectedIndex].innerHTML);"><option value="0">请选择市</option></select></div>',s+="</div>",$("#city_select").html(s),t&&this.provinceSelected(t)}else this.initData(this.insertCitySelect)},provinceSelected:function(e){if(parseInt(e)){var t,i='<option value="0">请选择市</option>';for(var s in this.cityInfo[e].cityList){var o="";this.setting.defaultCityId&&s==this.setting.defaultCityId&&(o=' selected="selected"',t=[s,this.cityInfo[e].cityList[s].cityName]),i+='<option value="'+s+'"'+o+">"+this.cityInfo[e].cityList[s].cityName+"</option>"}this.selectedProvinceId=e,this.exprId=!1,$("#city_list").html(i),$("#pro_sel_box").css("border-color","#ddd"),$("#expr_sel").html('<option value="0">请选择体验馆</option>'),t&&this.citySelected.apply(this,t)}},citySelected:function(e,t){if(parseInt(e)){var i=[];for(var s in this.cityInfo[this.selectedProvinceId].cityList[e].exprList)i.push({exprName:this.cityInfo[this.selectedProvinceId].cityList[e].exprList[s],exprId:s,position:this.cityInfo[this.selectedProvinceId].cityList[e].exprInfo[s].position,need_appointment:this.cityInfo[this.selectedProvinceId].cityList[e].exprInfo[s].need_appointment});this.setting.exprInfo={cityName:t,exprList:i},this.selectedCityId=e,this.exprId=!1,$("#city_sel_box").css("border-color","#ddd"),this.insertExprSelect()}},analysisExprList:function(e,t){this.exprInitData={},this.callback=t;var i={};if(this.exprId)for(var s=0;s<e.expr_list.length;s++)if(e.expr_list[s]&&e.expr_list[s].expr_id==this.exprId){this.setting.defaultCityId=e.expr_list[s].city_id;break}for(var s=0;s<e.expr_list.length;s++){var o=e.expr_list[s],n=o.province_id,r=o.city_id,p=o.expr_id;this.exprInitData[p]=o,i[n]||(i[n]={provinceName:o.province__name,cityList:{}}),i[n].cityList[r]||(i[n].cityList[r]={cityName:o.city__name,exprList:{},exprInfo:{}}),i[n].cityList[r].exprList[p]=o.expr_alias,i[n].cityList[r].exprInfo[p]=o,(r==this.setting.defaultCityId||this.setting.exprInfo&&this.setting.exprInfo.cityName==o.city__name)&&(this.selectedProvinceId=n,this.selectedCityId=r,this.setting.exprInfo=this.setting.exprInfo||{},this.setting.exprInfo.cityName=o.city__name,this.setting.exprInfo.exprList=this.setting.exprInfo.exprList||[],this.setting.exprInfo.exprList.push({exprName:o.expr_alias,exprId:o.expr_id,position:o.position,need_appointment:o.need_appointment}))}this.successAdInfo=e.ad_info,this.real_expr_num=e.real_expr_num,this.cityInfo=i,this.selectedProvinceId||this.selectedCityId?this.insertExprSelect():this.insertCitySelect(),this.callback&&this.callback.call(this,e)}},$.sendPrizeNew.prototype.init.prototype=$.sendPrizeNew.prototype;