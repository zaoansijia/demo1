<style type="text/css">
    .sms-container{width:9.4rem;background:#fff;margin-top: 0.7rem;position: absolute;left:0.755rem;}
    .sms-container li{height:1.75rem;padding:0.25rem 0;}
    .sms-container li table{width:100%;}
    .sms-container select{height:1.75rem;color:#333;border:solid 1px #e3e3e3;padding:0 0.25rem;}
    .sms-container .select-province,
    .sms-container .select-city{width:4.575rem;}
    .sms-container .select-province{margin-right:0.3rem;}
    .sms-container .select-expr{width:100%;}
    .sms-container .input{height:0.7rem;padding:0.5rem 0.25rem;border:solid 1px #e3e3e3;}
    .sms-container .input input{height:0.7rem;width:100%;padding:0;border:0;outline:0;font-family:'黑体';}
    .sms-container .input-captcha{width:3.45rem;margin-right:0.25rem;}
    .sms-container .captcha-img{width:5rem;height:1.75rem;}
</style>
<script type="text/javascript">
    var dom = '<div class="sms-container">' +
            '<ul>' +
            '<li><table><tr>' +
            '<td>' +
            '<select id="jsRegionProvince" class="select-province"><option value="-1">请选择省</option></select>' +
            '</td>' +
            '<td>' +
            '<select id="jsRegionCity" class="select-city"><option value="-1">请选择市</option></select>' +
            '</td>' +
            '</tr></table></li>' +
            '<li><table><tr>' +
            '<td>' +
            '<select id="jsRegionExpr" class="select-expr"><option value="-1">请选择体验馆</option></select>' +
            '</td>' +
            '</tr></table></li>' +
            '<li><table><tr>' +
            '<td><div class="input"><input type="text" placeholder="请输入您的电话号码" class="phone" maxlength="11" id="jsSendExprAddressPhone" /></div></td>' +
            '</tr></table></li>' +
            '<li><table><tr>' +
            '<td><div class="input input-captcha"><input type="text" placeholder="验证码" class="captcha" maxlength="4" id="jsSendExprAddressCaptcha" /></div></td>' +
            '<td align="right"><img src="http://m.meilele.com/solr_api/captcha/getCaptcha.do?&_=0.5704961647279561" class="captcha-img" id="jsSendExprAddressCaptchaImg" onclick="$$.getCaptcha(this);document.getElementById("jsSendExprAddressCaptcha").value="";" /></td>' +
            '</tr></table></li>' +
            '</ul>' +
            '</div>';
    $('#JS_img_20').before(dom);
    !function($){
        var region = {
            init: function() {
                var that = $._currentHandler = this;

                this.proivinceId = -1;
                this.cityId = -1;
                this.exprId = -1;

                // 判断体验馆信息是否有本地数据
                if ( $._currentHandler.storage && $._currentHandler.storage.allRegionData ) {
                    var localData = JSON.parse($._currentHandler.storage.allRegionData);
                    $._currentHandler.day = (new Date().getTime() - localData.expire) / (1000 * 3600 * 24);
                    if ($._currentHandler.day < 1) {
                        this.formartRegionData(localData, function(){
                            that.fillProvince();
                        });
                    } else {
                        this.getRegionData(function(){
                            that.fillProvince();
                        });
                    }
                } else {
                    this.getRegionData(function(){
                        that.fillProvince();
                    });
                }

                $$.getCaptcha($('#jsSendExprAddressCaptchaImg'));
                $('#jsSendExprAddressPhone').val($.cookie("sendSmsPhone") || '');

                $('#jsRegionProvince').on('change', function(){
                    var id = $(this).val();
                    that.selectProvince(id);
                });
                $('#jsRegionCity').on('change', function(){
                    var id = $(this).val();
                    that.selecCity(id);
                });
                $('#jsRegionExpr').on('change', function(){
                    var id = $(this).val();
                    that.selecExpr(id);
                });

                $('#JS_img_23').click(function(){
                    that.submit();
                });
            },

            getRegionData: function(callback) {
                var
                        that = this,
                        date = new Date();

                $.ajax({
                    url: '/mll_api/api/send_message?type=exprAddress&ad_code=exprAddress_success_notice&ad_code_t=qr_des' + date.getFullYear() + date.getMonth() + date.getDate(),
                    type: 'GET',
                    dataType: 'json',
                    cache: true,
                    success: function (json) {
                        if (json) {
                            // 格式化体验馆数据
                            that.formartRegionData(json, callback);

                            if ($._currentHandler.storage || ($._currentHandler.storage && $._currentHandler.day > 1)) {

                                //增加一个字段保存存入时的时间戳
                                json.expire = new Date().getTime();

                                //存入localStorage
                                $._currentHandler.storage.setItem('allRegionData', JSON.stringify(json));
                            };
                        }
                    }
                });
            },

            formartRegionData: function (json, callback) {
                var
                        len = json.expr_list.length,
                        exprTmp = {};

                for (var i = 0; i < len; i++) {
                    var
                            item = json.expr_list[i],
                            pid = item.province_id,
                            cid = item.city_id,
                            eid = item.expr_id;

                    if ( !exprTmp[pid] ) {
                        exprTmp[pid] = {
                            province_id: pid,
                            province_name: item.province__name,
                            cityList: {}
                        };
                    }

                    if ( !exprTmp[pid].cityList[cid] ) {
                        exprTmp[pid].cityList[cid] = {
                            city_id: cid,
                            city_name: item.city__name,
                            exprList: {}
                        };
                    }

                    exprTmp[pid].cityList[cid].exprList[eid] = item;
                }

                this.allRegionData = exprTmp;

                if ( callback && typeof callback === 'function' ) {
                    callback(exprTmp);
                }
            },

            fillProvince: function() {
                var
                        data = this.allRegionData,
                        option = [];

                option.push('<option value="-1">请选择省</option>');
                for ( k in data ) {
                    option.push('<option value="'+ data[k].province_id +'">'+ data[k].province_name +'</option>');
                }

                $('#jsRegionProvince').html(option.join(''));
            },

            selectProvince: function(proivinceId) {
                var
                        data = this.allRegionData[proivinceId].cityList,
                        option = [];

                option.push('<option value="-1">请选择市</option>');
                for ( k in data ) {
                    option.push('<option value="'+ data[k].city_id +'">'+ data[k].city_name +'</option>');
                }

                $('#jsRegionCity').html(option.join(''));

                this.proivinceId = proivinceId;
            },

            selecCity: function(cityId) {
                if ( cityId == '-1' ) {
                    return;
                }
                var
                        data = this.allRegionData[this.proivinceId].cityList[cityId].exprList,
                        option = [];

                option.push('<option value="-1">请选择体验馆</option>');
                for ( k in data ) {
                    option.push('<option value="'+ data[k].expr_id +'">'+ data[k].expr_alias +'</option>');
                }

                $('#jsRegionExpr').html(option.join(''));

                this.cityId = cityId;
            },

            selecExpr: function(exprId) {
                this.exprId = exprId;
            },

            clearCaptcha: function() {
                $('#jsSendExprAddressCaptcha').val('');
            },

            submit: function() {
                if ( this.isLock ) {
                    return;
                }

                var
                        pid = this.proivinceId,
                        cid = this.cityId,
                        eid = this.exprId,
                        phoneInput = $('#jsSendExprAddressPhone'),
                        captchaInput = $('#jsSendExprAddressCaptcha'),
                        phone = phoneInput.val().replace(/^\s|\s$/, ''),
                        captcha = captchaInput.val().replace(/^\s|\s$/, '');

                if ( pid == '-1' ) {
                    $$.alert('请选择省！');
                    return false;
                }
                if ( cid == '-1' ) {
                    $$.alert('请选择市！');
                    return false;
                }
                if ( eid == '-1' ) {
                    $$.alert('请选择体验馆！');
                    return false;
                }
                if ( !/^1\d{10}/.test(phone) ) {
                    $$.alert('请输入手机号码！');
                    return false;
                }
                if ( captcha.length < 4 ) {
                    $$.alert('请输入验证码！');
                    return false;
                }

                var tmpData = {
                    type: 'exprAddress',
                    phoneNumber: $.cookie("sendSmsPhone") || false,
                    postionCode: '',
                    checkPhone: false
                }

                this.isLock = true;

                $.ajax({
                    url: '/java_api/jmll/expr/getExprAddr.do?&mobile=' + phone + '&captcha=' + captcha + '&expr_id=' + eid,
                    data: tmpData,
                    type: 'get',
                    dataType: 'json',
                    success: function (json) {
                        if ( json.error == "0" || json.code == "success" || json.error == "2" ) {
                            $$.alert(json.msg);
                            $$.getCaptcha($('#jsSendExprAddressCaptchaImg'));
                            $._currentHandler.clearCaptcha();
                            $._currentHandler.isLock = false;
                        } else {
                            $$.alert(json.msg);
                            $$.getCaptcha($('#jsSendExprAddressCaptchaImg'));
                            $._currentHandler.clearCaptcha();
                            $._currentHandler.isLock = false;
                            return false;
                        }
                        that.captcha_flag = false; //验证码掷为flase
                    },
                    error: function () {
                        $$.alert("发送失败");
                        $$.getCaptcha($('#jsSendExprAddressCaptchaImg'));
                        $._currentHandler.clearCaptcha();
                        $._currentHandler.isLock = false;
                    }
                });
            }
        };

        region.init();
    }(Zepto);
</script>
<script type="text/javascript">
    function prize(){
        $$.prize(false,{prize_id:436,type:'get_prize_all',exprList:true})
    }
    //领预约码
    function get_limited_prize1( gid ) {
        $$.prize( false,{ type:'get_limited_prize', prize_id:'1431_'+gid, moblieChap:true, exprList:true,notite:'优惠券 2016/8/1-2016/8/14到就近体验馆使用，每个订单只能使用1个验证码' });
    }
</script>
<style>
    .m-images-box,.m-special-box{background-color: #0f75b1;}
</style>
<!--活动商品：activity_goods_ief0e7a0 START-->
<!--
[activity_goods_list_start]
$activity = array();
$activity['image'] = '';
$activity['rule'] = '';
$activity['content']='';
$activity[] = array(
    'name' => '0元购||17||2||#0f75b1',
    'goods' => 'KSHT-YN-A397-18C[美式田园1.8米樱桃木纹床]{3899}||800,HFE-888-WSTZ30[韩式田园卧室3件套]{5999}||1000,KSHT-KSH-A023-18C[美式古典1.8米雕花帝王床]{5399}||500,KXS-DDX-CL193-AB-ZJL[实木框架储物布艺沙发]{5890}||500,DMY-ND-1-ZJSF-L[现代风格舒适黄牛真皮沙发]{7000}||800,KSHT-GB-488-ZJL[巴西进口头层黄牛皮沙发]{8699}||500,HFE-888#-SFTZ[韩式田园实木框架布艺沙发]{9699}||1000,LM-9152-ZJR[欧式纯手工红杨木雕花弹簧沙发]{10990}||1000,JHS-ST1006-5TZ[天然大理石台面1.5米餐厅套装]{4232}||500,KSHT-YN-341-7TZ[1.98米地中海实木餐厅套装]{5259}||800,ABC-M103A-TZ[英式风格1.59米餐厅套装]{5876}||800,HFE-803#-SIMYG[韩式田园2.0米平开四门衣柜]{3980}||800'
);
$activity[] = array(
    'name' => '家具||18||1||#0f75b1',
    'goods' => 'SD-FLXS-8239CH6-DD[天使的翅膀六头吊灯]{},SD-MD6013-6-DD[唯美六头吊灯]{},SD-YY-NC051-8H-DD[复古奢华全铜吊灯]{},SD-PFE-495-XDD[磨砂白玉玻璃吸顶灯]{},OD-HCMS-WTS819-YSG[进口橡木浴室柜]{},36277-147[多功能手持花洒套装]{}'
);
//分类切换商品
$cat_goods = array();
$cat_goods[13] = array(
    array(
        'id' => 'slide-1',
        'background' => 'http://image.meilele.com/images/zhuanti//tabred_03_1468831202.jpg|http://image.meilele.com/images/zhuanti//tabyellow_04_1468831135.jpg',
        'goods' => array(
            array('goods_sn'=>'KSHT-YN-341-15C','title'=>'鼠标移上去显示我自己配置的1','goods_name'=>'美国进口白杨木1.5米床'),
            array('goods_sn'=>'CFJ-TJ-002-TZ1','title'=>'鼠标移上去显示我自己配置的1','goods_name'=>'现代风格卧室3件套')
        )
    ),
    array(
        'id' => 'slide-1',
        'background' => 'http://image.meilele.com/images/zhuanti//tabred_04_1468831254.jpg|http://image.meilele.com/images/zhuanti//tabyellow_05_1468831230.jpg',
        'goods' => array(
            array('goods_sn'=>'KSHT-KSH-803#-ZJL','title'=>'鼠标移上去显示我自己配置的1','goods_name'=>'提花刺绣转角沙发'),
            array('goods_sn'=>'SME-LH-F2139-ZJL','title'=>'鼠标移上去显示我自己配置的1','goods_name'=>'时尚宽扶L型转角沙发')
        )
    ),
    array(
        'id' => 'slide-1',
        'background' => 'http://image.meilele.com/images/zhuanti//tabred_05_1468831295.jpg|http://image.meilele.com/images/zhuanti//tabyellow_06_1468832083.jpg',
        'goods' => array(
            array('goods_sn'=>'DMY-YJ-T1295B-CTTZ','title'=>'鼠标移上去显示我自己配置的1','goods_name'=>'可折叠拉伸餐桌椅套装'),
            array('goods_sn'=>'KSHT-YN-341A-5TZ','title'=>'鼠标移上去显示我自己配置的1','goods_name'=>'1.3米实木餐厅套装')
        )
    ),
    array(
        'id' => 'slide-1',
        'background' => 'http://image.meilele.com/images/zhuanti//tabred_06_1468831745.jpg|http://image.meilele.com/images/zhuanti//tabyellow_07_1468831326.jpg',
        'goods' => array(
            array('goods_sn'=>'QCKJ-SM-C616S-12C-1','title'=>'鼠标移上去显示我自己配置的1','goods_name'=>'进口芬兰松1.2米双层儿童床'),
            array('goods_sn'=>'HFE-811#-12C1','title'=>'鼠标移上去显示我自己配置的1','goods_name'=>'1.2米排骨架儿童床')
        )
    ),
    array(
        'id' => 'slide-1',
        'background' => 'http://image.meilele.com/images/zhuanti//tabred_07_1468831416.jpg|http://image.meilele.com/images/zhuanti//tabyellow_08_1468831397.jpg',
        'goods' => array(
            array('goods_sn'=>'HFE-813#-DNT','title'=>'鼠标移上去显示我自己配置的1','goods_name'=>'象牙白实木书台'),
            array('goods_sn'=>'HFE-835#-SG','title'=>'鼠标移上去显示我自己配置的1','goods_name'=>'韩式田园实木书柜')
        )
    )
);
[activity_goods_list_end]
-->
<!--活动商品：activity_goods_ief0e7a0 END-->
<!-- Tab切换：START -->
<script type="text/javascript">
    var swiper = new Swiper('#slide-1',{
        slidesPerView: 'auto',
        wrapperClass : 'm-sort-list',
        slideClass : 'item',
        roundLengths : true,
        onTap : function(swiper){
            var idx = swiper.clickedIndex;
            swiper.$('.item').find('img.img2').addClass('none');
            swiper.$('.item').find('img.img1').removeClass('none');
            swiper.$('.item').eq(idx).find('img.img2').removeClass('none');
            swiper.$('.item').eq(idx).find('img.img1').addClass('none');
            swiper.$('.item-list').find('ul').addClass('none');
            swiper.$('.JS_list_'+(idx+1)).removeClass('none');
        }
    });
</script>
<!-- Tab切换：END -->


<!-- 滚动抽奖号码：开始 -->
<style>
    .zj-report{height: 30px;position: absolute;top: 8.68rem;z-index: 12;font-family: "微软雅黑";}
    .zj-report .report-title{ font-size: 12px; color: #FFF; font-weight: bold; line-height: 30px; padding-left: 2.1rem;}
    .zj-report .zj-view{width:10.5rem;overflow:hidden;height:30px;line-height:30px;font-size:12px;margin-left: 0.3rem; float: right;}
    .zj-report .zj-distance{width:8000px;}
    .zj-report .show_span{color:#ffec14;}
    .zj-report .prize-name{color:#ffec14;}
    @media screen and (min-width: 360px){.zj-report{top: 8.7rem;} }
    @media screen and (min-width: 375px){.zj-report{top: 8.8rem;}  }
    @media screen and (min-width: 384px){.zj-report{top: 8.8rem;} }
    @media screen and (min-width: 412px){.zj-report{top: 8.81rem;}  }
    @media screen and (min-width: 414px){.zj-report{top: 8.82rem;} }
    @media screen and (min-width: 600px){.zj-report{top: 9.06rem;} }
    @media screen and (min-width: 800px){.zj-report{top: 9.1rem;} }
</style>

<script type="text/javascript">
    var html = '';
    html += '<div class="zj-report"><span class="report-title">中奖播报:</span><div id="JS_view" class="zj-view"><div class="zj-distance clearfix"><div id="JS_show_span_1" class="show_span Left"></div><div id="JS_show_span_2" class="show_span Left"></div></div></div></div>';
    $('.m-special-box').append(html);
    // 获取数据
    $.ajax({
        url:"http://www.meilele.com/mll_api/api/lottery?type=436&limit_end=15&callback=mlottery",
        dataType:"jsonp",
        success:function(json){
            var num = json.count[0].count_num;
            //$('#JS_sale_cj').html('已有<span id="xzdj">'+num+'人</span>'+'<span >领取</span>');
            json = json.data;
            var h = '';
            for(var i = 0, ii = json.length; i < ii; i++){
                h += '恭喜'+json[i].tel+'抽中<span class="prize-name" style="margin-right: 5px;">'+json[i].prize_name+'</span>';
            }
            $('#JS_show_span_1').html(h);
            $('#JS_show_span_2').html(h);
            window.srcollList = new scrollList('JS_view','JS_show_span_1',100,3);
        }
    });
    function scrollList(viewId,showID,timer,step){
        this.viewId = document.getElementById(viewId);
        this.showID = document.getElementById(showID);
        this.distanceLeft = this.showID.offsetWidth;
        this.timer = timer;
        this.step = step;
        this.goRun = true;
        var that = this;
        that.viewId.onmouseover = function(){
            that.goRun = false;
        }
        that.viewId.onmouseout = function(){
            that.goRun = true;
        }
        setInterval(function(){
            if (that.goRun) {

                that.run();
            }
        },that.timer)
    }
    scrollList.prototype.run = function(viewId,showID,timer){
        that = this;

        if ( that.viewId.scrollLeft >= that.distanceLeft ) {
            that.viewId.scrollLeft = 0;
        }else{
            that.viewId.scrollLeft += that.step;
        }
    }

</script>
<!-- 滚动抽奖号码：结束 -->
<!--预约码领取开始-->
<script>

    //百万土豪红包
    function limited_price(obj){
        var goodsID;
        if($(obj).attr('data-tid')){
            goodsID = $(obj).attr('data-tid');
        }else{
            goodsID = obj;
        }

        if ($.cookie('ECS_MLL_SE') > 0 || $.cookie('ECSCP_ID ') > 0) {
            $.alert('仅限到店之前领取!');
        } else {
            $.sendPrize(null, {
                type: 'get_limited_prize',
                notice: '<b>温馨提示：</b>仅限2016.7.18-2016.7.31期间参与抢码，请于2016.7.18-2016.7.31期间到就近体验馆使用，每个订单只能使用1个序列码',
                unique: 1186,
                checkPhone: true,
                activityType:19,
                click: '专题领取有限红包',
                prize_id: '1186_' + goodsID
            });
        }
    }
</script>
<!--预约码领取结束-->